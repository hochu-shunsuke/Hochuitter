{% extends "base.html" %}

{% block content %}
    <h1>投稿一覧</h1>
    <h5>投稿日順に新しいものから50個表示されています!</h5>
    <div id="timeline">
        <ul>
            {% for post in parent_posts %} <!--viewsのindexからparent_postsを受け取っている-->
                投稿者:<a href="{% url 'social:userpage' user_id=post.user.id %}" class="user">@{{ post.user }}</a>
                <li>{{ post.content }}</li>
                <a href="{% url 'post:toggle_like' %}"><button>♡</button></a>{{ post.like_count }}
                <a href="{% url 'post:index' %}"><button>💬</button></a>{{ post.comment_count }}
                <li>投稿日時:{{ post.post_date }}</li>
                <p>----------------------------------------------------------------------------------------------</p>
            {% empty %}
                <li>投稿がありません。</li>
            {% endfor %}
        </ul>
    </div>
{% endblock %}


<!--このようにpost_idをAJAXで取得するとurlを正しく生成できる-->
<!--
{% extends "base.html" %}

{% block content %}
    <h1>投稿一覧</h1>
    <h5>投稿日順に新しいものから50個表示されています!</h5>
    <div id="timeline">
        <ul>
            {% for post in parent_posts %}
            <li>
                投稿者: <a href="{% url 'social:userpage' user_id=post.user.id %}" class="user">@{{ post.user }}</a>
                <div>{{ post.content }}</div>
                <button class="like-button" data-post-id="{{ post.id }}">
                    ♡ <span class="like-count">{{ post.like_count }}</span>
                </button>
                <a href="{% url 'post:index' %}"><button>💬</button></a>{{ post.comment_count }}
                <div>投稿日時: {{ post.post_date }}</div>
                <p>----------------------------------------------------------------------------------------------</p>
            </li>
        {% empty %}
            <li>投稿がありません。</li>
        {% endfor %}
    </ul>
</div>

<script>
    document.querySelectorAll('.like-button').forEach(button => {
        button.addEventListener('click', function() {
            const postId = this.getAttribute('data-post-id');
            fetch(`/post/${postId}/toggle_like/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}', // CSRFトークンを追加
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                this.querySelector('.like-count').textContent = data.like_count; // いいね数を更新
            });
        });
    });
</script>
{% endblock %}

-->
