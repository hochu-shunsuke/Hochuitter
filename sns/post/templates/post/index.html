<!--ã“ã®ã‚ˆã†ã«post_idã‚’AJAXã§å–å¾—ã™ã‚‹ã¨urlã‚’æ­£ã—ãç”Ÿæˆã§ãã‚‹-->
{% extends "base.html" %}

{% block content %}
    <h1>æŠ•ç¨¿ä¸€è¦§</h1>
    <h5>æŠ•ç¨¿æ—¥é †ã«æ–°ã—ã„ã‚‚ã®ã‹ã‚‰50å€‹è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™!</h5>
    <div id="timeline">
        <ul>
            {% for post in parent_posts %}
            æŠ•ç¨¿è€…: <a href="{% url 'social:userpage' user_id=post.user.id %}" class="user">@{{ post.user }}</a>
            <li>
                <div>{{ post.content }}</div>
                <button class="like-button" data-post-id="{{ post.id }}">â™¡<span class="like-count">{{ post.like_count }}</span>
                </button>
                <a href="{% url 'post:index' %}"><button>ğŸ’¬</button></a>{{ post.comment_count }}
                <div>æŠ•ç¨¿æ—¥æ™‚: {{ post.post_date }}</div>
                <p>----------------------------------------------------------------------------------------------</p>
            </li>
        {% empty %}
            <li>æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</li>
        {% endfor %}
    </ul>
</div>

<script>
    //ã„ã„ã­ãƒœã‚¿ãƒ³ã®é–¢æ•°
    document.querySelectorAll('.like-button').forEach(button => {
        button.addEventListener('click', function() {
            const postId = this.getAttribute('data-post-id');
            //ã“ã“ã§fetchã«å¯¾ã—ã¦postidã«å¿œã˜ã¦å‹•çš„ã«URLã‚’å‚ç…§ã•ã›ã‚‹
            fetch(`/${postId}/toggle/like/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}', // CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿½åŠ 
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                this.querySelector('.like-count').textContent = data.like_count; // ã„ã„ã­æ•°ã‚’æ›´æ–°
            });
        });
    });
</script>
{% endblock %}
